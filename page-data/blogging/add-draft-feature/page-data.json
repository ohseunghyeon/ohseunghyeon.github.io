{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogging/add-draft-feature/","webpackCompilationHash":"a2a54dead4c704d2ac0a","result":{"data":{"site":{"siteMetadata":{"title":"Lazy Nyaong","author":"Oh SeungHyeon"}},"markdownRemark":{"id":"9a66e8c1-5730-5532-9f8a-73c6f48a402b","excerpt":"…","html":"<h2>발단</h2>\n<p>어떤 주제에 대한 글을 쓰려고 폴더와 파일을 만들어 놓고 ‘나중에 써야지’ 생각했다. 나중에 기분 좋고, 시간 많을 때 조금 더 조사해서 써야지 생각했는데, 파일은 만들어놓고 싶었다.</p>\n<p>파일을 만들어 놓는 건 내가 해오던 일종의 습관인데, 대학에 다니던 시절에도 과제가 생기면 일단 파일을 만들어뒀었다. 그리고 어떤 방향으로 갈지, 어떤 내용을 적을지 생각하고 메모하고, 한 번에 다 하지 않고 조금씩 조금씩 나눠서 적었었다.</p>\n<p>블로그 글도 그렇게 하려다 보니까 폴더랑 index.md를 만들어 놓고 그냥 뒀다. 그랬더니 빌드할 때 얘가 포함이 된다. 그래서 파일은 일단 지워두고 폴더만 내버려뒀다. 하지만 그런 것도 언제까지 할 텐가? draft 플래그를 넣고 걔네는 빌드가 안 되면 되지.</p>\n<h2>시도</h2>\n<p>gatsby-node.js 파일을 보면 graphql query가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  allMarkdownRemark<span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">sort</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>frontmatter___date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">order</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">DESC</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token attr-name\">limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    edges <span class=\"token punctuation\">{</span>\n      node <span class=\"token punctuation\">{</span>\n        fields <span class=\"token punctuation\">{</span>\n          slug\n        <span class=\"token punctuation\">}</span>\n        frontmatter <span class=\"token punctuation\">{</span>\n          title\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>filter를 넣어서 frontmatter에 draft가 true면 글을 가져오지 않게 했다. 그랬더니 index 페이지에 글 목록에선 남아 있고 글을 누르면 빈 화면이 나온다.</p>\n<p>아, index 페이지에서도 없애야 하는구나. gatsby-node에서는 페이지를 만드는 부분이구나. 그래서 <strong>/src/pages/index.js</strong>에도 filter를 위와 같이 넣었다. 그랬더니 글이 더 이상 나오지 않는다!</p>\n<p>내가 제대로 한 걸까? 내가 한 것과 같은 기능을 구현한 사람들은 어떻게 했는지 검색을 했다. 그리고 <a href=\"https://dev.to/cole_ruche/implementing-a-draft-feature-in-a-gatsby-blog-1m7o\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">이 글</a>을 찾았다.</p>\n<p>기본적으로는 똑같이 구현을 했네. 그런데 이 사람은 RSS feed에 대해서 언급을 해놨다. 아, RSS에서도 없애야겠구나? 그런데 내 블로그엔 sitemap도 있는데? 그리고 앞으로 카테고리 페이지를 넣으면 그 쪽에도 동일한 로직이 들어갈 거고. 중복이 너무 많다.</p>\n<p>draft가 true이면 글을 포함하지 않는 로직을 최소 4군데 이상 넣고 앞으로도 다른 곳에 넣을지도 모른다. 아무래도 query를 실행하는 시점이 아닌 블로그 글들을 가져오는 부분에서 먼저 걸러내야겠다고 생각했다.</p>\n<p>그래서 gatsby-config.js에서 gatsby-source-filesystem 부분을 확인하고 이 플러그인의 doc을 참고했다. 그런데 딱히 내가 원하는 기능을 구현할 수 있을 것 같지 않다.</p>\n<h2>안 하기로 했다</h2>\n<p>Gatsby 문서를 계속 읽을 생각인데, 앞으로 좋은 방법이 보이면 그 방법을 취할 것이다. 그러나 그 전에는 이 작업을 하지 않기로 했다.</p>\n<p>왜냐면 draft를 걸러내는 로직을 여기저기 넣는 건 중복이 너무 많다. 더군다나 그 많은 일을 하고도 내가 draft인지 아닌지를 적고 지우는 작업은 여전히 해야한다.</p>\n<p>가만 생각해보니 md 파일을 만들고 확장자만 잠시 바꿔두면 될 일이다. 왜 진즉에 이 생각을 못 했을까? 그저 파일을 만들거나 지워놓는 생각만 했다.</p>\n<p>그냥 확장자 명을 draft 정도로 하고 다시 복귀하는 방향으로 가야겠다.</p>","frontmatter":{"title":"Gatsby 블로그에 Draft 기능 추가하기","date":"September 19, 2019","description":"작성중인 게시글이 블로그에 포함되지 않게 배포하기"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blogging/add-draft-feature/","previous":{"fields":{"slug":"/algorithm/programmers/프린터/"},"frontmatter":{"title":"프린터"}},"next":null}}}